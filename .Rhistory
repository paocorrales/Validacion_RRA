}
}
return(out)
}
read.obs(filepath)[]
read.obs <- function(filepath) {
files <- Sys.glob(filepath)
#Para archivos con obs cada 10 minutos
date <- lubridate::ymd_hm(stringi::stri_sub(basename(files), 5, 16))
for (i in 1:length(files)) {
to.read <- file(files[i], 'rb')
all.data <- readBin(to.read, 'numeric', size = 4, n = file.size(files[i])/4, endian = "little")
close(to.read)
obs <- all.data[all.data != all.data[1]]
obs <- data.table::as.data.table(matrix(obs, ncol = 7, byrow = TRUE))
colnames(obs) <- c("obs.id", "lon", "lat", "elev", "obs", "error", "sub.id")
date_obs <- date[i]
obs[, time := date_obs]
print(i)
if (i == 1) {
out <- obs
} else {
out <- rbind(out, obs)
}
}
return(out)
}
obs <- read.obs(filepath)
read.obs <- function(filepath) {
files <- Sys.glob(filepath)
#Para archivos con obs cada 10 minutos
date <- lubridate::ymd_hm(stringi::stri_sub(basename(files), 5, 16))
for (i in 1:length(files)) {
to.read <- file(files[i], 'rb')
all.data <- readBin(to.read, 'numeric', size = 4, n = file.size(files[i])/4, endian = "little")
close(to.read)
obs <- all.data[all.data != all.data[1]]
obs <- data.table::as.data.table(matrix(obs, ncol = 7, byrow = TRUE))
colnames(obs) <- c("obs.id", "lon", "lat", "elev", "obs", "error", "sub.id")
date_obs <- date[i]
obs[, time := date_obs]
if (i == 1) {
out <- obs
} else {
out <- rbind(out, obs)
}
}
return(out)
}
obs <- read.obs(filepath)
unique(obs$time)
uv <- obs[obs.id %in% c(2819, 2820)]
obs[, .N, by = .(obs.id)]
uv[, .N, by = .(time)]
uv[, .N, by = .(time, sub.id)]
goeswind <- uv[sub.id == 4]
unique(goeswind$elev)
library(metR)
library(ggplot2)
library(interp)
library(patchwork)
goeswind[1:5000] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
geom_point(aes(obs))
library(dplyr)
goeswind[1:5000] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
geom_point(aes(obs))
goeswind[1:5000] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
geom_point(aes(obs, color = obs))
topo <- GetTopography(360-67.5, 360-55, -24, -39, 0.25)
range(topo$lon)
range(uv$lon)
range(goeswind$lon)
goeswind[1:5000] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(obs, color = obs))
range(goeswind[1:5000]$lon)
goeswind[1:5000] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(obs, color = obs))
goeswind[1:5000] %>%
.[obs.id == 2819]
goeswind[1:5000] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(obs, color = obs))
goeswind[1:5000] %>%
.[obs.id == 2819]
str(goeswind[1:5000] %>%
.[obs.id == 2819])
goeswind[1:5000] %>%
.[obs.id == 2819] %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(obs, color = obs))
goeswind[1:5000] %>%
.[obs.id == 2819] %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(obs, color = obs))
goeswind[1:5000] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(obs, color = obs))
ggplot()
ggplot
goeswind[1:5000] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(obs, color = obs))
goeswind[1:5000] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = obs))
goeswind[1:5000] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = obs))
goeswind[1:10000] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = obs))
goeswind[1:10000] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = elev))
obs[, .N, by = .(sub.id)]
obs[, .N, by = .(obs.id, sub.id)]
uv[, .N, by = .(obs.id, sub.id)]
airs <- uv[sub.id == 1]
airs[1:10000] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = elev))
airs[1:10000] %>%
# .[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = elev))
airs
airs[1:10000] %>%
# .[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = obs))
airs[1:10000] %>%
# .[obs.id == 2819] %>%
ggplot(aes(obs, elev)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = obs))
airs[1:10000] %>%
# .[obs.id == 2819] %>%
ggplot(aes(obs, elev)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = lat))
airs[1:10000] %>%
# .[obs.id == 2819] %>%
ggplot(aes(obs, elev)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = factor(lat)))
airs[lat < -40] %>%
# .[obs.id == 2819] %>%
ggplot(aes(obs, elev)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = factor(lat)))
airs[lat < -40]
View(uv)
View(airs)
View(goeswind)
airs <- uv[sub.id == 1]
View(uv)
View(uv)
View(airs)
str(airs)
str(uv)
airs <- uv[sub.id == 1]
str(airs)
airs$time
airs$time[1]
str(airs$time[1]
airs[, hour(time)]
airs[, data.table::hour(time)]
library(data.table)
airs <- uv[sub.id == 1]
airs
str(airs)
uv[sub.id == 1, hour(time)]
uv[hour(time)]
uv[, hour(time)]
uv[, .(time, hour(time))4]
uv[, .(sub.id, hour(time))]
uv[, .(sub.id, hour(time))][sub.id == 1]
airs[, hour(time=)]
airs[, hour(time)]
ris
airs
obs
obs[36482]
obs[1]
as.POSIXct("2018-11-20 32:00:00")
as.POSIXct("2018-11-20 23:00:00")
as.POSIXct("2018-11-20 00:00:00")
as.POSIXct("2018-11-20 01:00:00")
airs[lat < -40] %>%
# .[obs.id == 2819] %>%
ggplot(aes(obs, elev)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = factor(obs.id)))
range(airs$elev)
range(airs$lat)
unique(uv$sub.id)
uv[, .N, by = .(sub.id)]
uv[sub.id == 9] %>%
# .[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = obs))
uv[sub.id == 9]
range(uv[sub.id == 9]$elev)
uv[sub.id == 9] %>%
# .[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = obs))
range(uv[sub.id == 9]$lon)
uv[sub.id == 3] %>%
# .[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = obs))
bufr <- fread('../test1.csv')
View(bufr)
uv[sub.id == 3] %>%
# .[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = obs))
uv[sub.id == 3] %>%
# .[obs.id == 2819] %>%
ggplot(aes(obs, elev)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = factor(obs.id)))
uv[sub.id == 3]
uv[sub.id == 3] %>%
# .[obs.id == 2819] %>%
ggplot(aes(elev, obs)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = factor(obs.id)))
uv[sub.id == 3] %>%
# .[obs.id == 2819] %>%
ggplot(aes(elev, obs)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = factor(obs.id)))
uv[sub.id == 3] %>%
# .[obs.id == 2819] %>%
ggplot(aes(elev, obs)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = factor(obs.id)))
uv[sub.id == 3] %>%
# .[obs.id == 2819] %>%
ggplot(aes(obs, elev)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = factor(obs.id)))
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = obs)
uv[sub.id == 3] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, elev)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = obs))
range(uv$elev)
uv[sub.id == 3] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, elev)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = obs)) +
scale_y_level()
uv[sub.id == 9] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, elev)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = obs)) +
scale_y_level()
uv[sub.id == 1] %>%
.[obs.id == 2819] %>%
ggplot(aes(lon, elev)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = obs)) +
scale_y_level()
library(data.table)
bufr <- fread('../test1')
View(bufr)
bufr <- fread('../test1', na.strings = "1e11")
View(bufr)
bufr <- fread('../test1', na.strings = "1e+11")
View(bufr)
range(bufr$V6)
range(bufr$V12)
bufr <- fread('../test1', na.strings = "100000000000")
View(bufr)
bufr <- fread('../test1', na.strings = "10000000000")
View(bufr)
bufr <- fread('../test1', na.strings = "100000000000.000")
View(bufr)
unique(bufr$V1)
wind <- bufr[V1 == SATWND]
wind <- bufr[V1 == "SATWND"]
View(wind)
range(bufr$V12)
range(bufr$V12, na.rm = TRUE)
range(bufr$V13, na.rm = TRUE)
range(bufr$V117, na.rm = TRUE)
range(bufr$V17, na.rm = TRUE)
range(bufr$V19, na.rm = TRUE)
range(bufr$V18, na.rm = TRUE)
unique(bufr$V7, na.rm = TRUE)
range(bufr$V8, na.rm = TRUE)
range(bufr$V9, na.rm = TRUE)
range(bufr$V10, na.rm = TRUE)
b <- read.csv('../test1', sep = ' ', na.strings = '100000000000.000')
View(b)
b <- read.csv('../test1', sep = c(' ', '\t'), na.strings = '100000000000.000')
View(b)
b <- read.csv('../test1', sep = '', na.strings = '100000000000.000')
b <- read.csv('../test1', sep = '', na.strings = '100000000000.000', header = FALSE)
b[V7 == "181"]
b[V7 == 181]
b[V7 == 181,]
b[b$V7 == 181]
setDT(b)
b[V7 == 181]
b[V7 == 281]
v <- b[V7 == 281]
View(v)
b <- read.csv('../test1', sep = '', na.strings = '100000000000.000', header = FALSE)
View(b)
wind <- bufr[V1 == "SATWND"]
View(wind)
wind <- b[V1 == "SATWND"]
setDT(b)
wind <- b[V1 == "SATWND"]
View(wind)
wind[V6 == 0]
wind[V6 == 0.0]
library(ggplot2)
library(dplyr)
wind[1:5000] %>%
ggplot(aes(V4, V5)) +
geom_point(aes(color = V13))
library(metR)
topo <- GetTopography(360-67.5, 360-55, -24, -39, 0.25)
topo[, lon := ConvertLongitude(lon)]
wind[1:5000] %>%
ggplot(aes(V4, V5)) +
geom_point(aes(color = V13)) +
geom_contour(data = topo, aes(z = h), color = "darkgray")
wind[1:5000] %>%
ggplot(aes(V4, V5)) +
geom_point(aes(color = V13)) +
geom_contour(data = topo, aes(z = h), color = "darkgray")
wind[1:5000] %>%
ggplot(aes(V4, V5)) +
geom_point(aes(color = V13))
wind[1:5000] %>%
ggplot(aes(V4, V5)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = V13))
wind[1:5000] %>%
ggplot(aes(V4, V5))
wind[1:5000] %>%
ggplot(aes(V4, V5)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = V13))
range(topo$lon)
range(wind$V4)
topo <- GetTopography(360-67.5, 360-55, -24, -39, 0.25)
wind[1:5000] %>%
ggplot(aes(V4, V5)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = V13))
range(topo$lon)
wind[V4 > 290 & V4 < 305] %>%
ggplot(aes(V4, V5)) +
geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = V13))
wind[V4 > 290 & V4 < 305]
wind[V4 > 290 & V4 < 305] %>%
ggplot(aes(V4, V5)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = V13))
range(topo$lat)
wind[V4 > 290 & V4 < 305 & V5 > -39 & V5 < -23] %>%
ggplot(aes(V4, V5)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = V13))
wind[V4 > 290 & V4 < 305 & V5 > -39 & V5 < -23]
filepath <- '../20181120_18/*0.dat'
read.obs <- function(filepath) {
files <- Sys.glob(filepath)
#Para archivos con obs cada 10 minutos
date <- lubridate::ymd_hm(stringi::stri_sub(basename(files), 5, 16))
for (i in 1:length(files)) {
to.read <- file(files[i], 'rb')
all.data <- readBin(to.read, 'numeric', size = 4, n = file.size(files[i])/4, endian = "little")
close(to.read)
obs <- all.data[all.data != all.data[1]]
obs <- data.table::as.data.table(matrix(obs, ncol = 7, byrow = TRUE))
colnames(obs) <- c("obs.id", "lon", "lat", "elev", "obs", "error", "sub.id")
date_obs <- date[i]
obs[, time := date_obs]
if (i == 1) {
out <- obs
} else {
out <- rbind(out, obs)
}
}
return(out)
}
temp <- read.obs(filepath)
head(temp)
temp[obs.id %in% c(2819, 2820)]
temp <- temp[obs.id %in% c(2819, 2820) ]
temp[, .N, by = .(sub.id)]
temp <- temp[obs.id %in% c(2819, 2820) & sub.id == 4]
temp <- temp[obs.id %in% c(2819, 2820) & sub.id == 4]
temp[lon := ConvertLongitude(lon)]
temp[lon := ConvertLongitude(lon),]
temp[, lon := ConvertLongitude(lon)]
temp <- temp[lon %in% c(290,305) & lat %in% c(-39, -23)]
ggplot(temp, aes(lon, lat)) +
geom_point(aes(color = obs))
temp <- read.obs(filepath)
temp <- temp[obs.id %in% c(2819, 2820) & sub.id == 4]
head(temp)
temp2 <- temp[lon %in% c(290,305) & lat %in% c(-39, -23)]
temp2 <- temp[lon %in% c(250,305) & lat %in% c(-39, -23)]
temp2 <- temp[lon > 290 & lon < 305 & lat > -39 & lat < -23]
ggplot(temp2, aes(lon, lat)) +
geom_point(aes(color = obs))
wind[V4 > 290 & V4 < 305 & V5 > -39 & V5 < -23] %>%
ggplot(aes(V4, V5)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = V13))
temp2[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
geom_point(aes(color = obs))
temp2[obs.id == 2819] %>%
ggplot(aes(lon, lat)) +
geom_point(aes(color = obs)) +
labs(title = "U (sat) 20181120_18")
ggsave("u_sat_RRA.png")
wind[V4 > 290 & V4 < 305 & V5 > -39 & V5 < -23] %>%
ggplot(aes(V4, V5)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = V13))
wind[V4 > 290 & V4 < 305 & V5 > -39 & V5 < -23] %>%
ggplot(aes(V4, V5)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = V13)) +
labs(title = "SATWIND_prepbufr.png")
wind[V4 > 290 & V4 < 305 & V5 > -39 & V5 < -23] %>%
ggplot(aes(V4, V5)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(aes(color = V13)) +
labs(title = "SATWIND_prepbufr")
ggsave("SATWIND_prepbufr.png")
temp3 <- temp2[obs.id == 2819]
wind[V4 > 290 & V4 < 305 & V5 > -39 & V5 < -23] %>%
ggplot(aes(V4, V5)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(data = temp3, aes(x = lon, y = lat, color = obs))
wind[V4 > 290 & V4 < 305 & V5 > -39 & V5 < -23] %>%
ggplot(aes(V4, V5)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(data = temp3, aes(x = lon, y = lat, color = obs)) +
geom_point(aes(color = V13)) +
labs(title = "SATWIND_prepbufr")
wind[V4 > 290 & V4 < 305 & V5 > -39 & V5 < -23] %>%
ggplot(aes(V4, V5)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(data = temp3, aes(x = lon, y = lat, color = red)) +
geom_point(aes(color = V13)) +
labs(title = "SATWIND_prepbufr")
wind[V4 > 290 & V4 < 305 & V5 > -39 & V5 < -23] %>%
ggplot(aes(V4, V5)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
geom_point(data = temp3, aes(x = lon, y = lat, color = "red")) +
geom_point(aes(color = V13)) +
labs(title = "SATWIND_prepbufr")
wind[V4 > 290 & V4 < 305 & V5 > -39 & V5 < -23] %>%
ggplot(aes(V4, V5)) +
# geom_contour(data = topo, aes(z = h), color = "darkgray") +
#geom_point(data = temp3, aes(x = lon, y = lat, color = "red")) +
geom_point(aes(color = V13)) +
labs(title = "SATWIND_prepbufr")
